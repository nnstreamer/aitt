SET(AITT_TCP aitt-transport-tcp)

PKG_CHECK_MODULES(AITT_TCP_NEEDS REQUIRED ${PKGS} flatbuffers glib-2.0)
INCLUDE_DIRECTORIES(${AITT_TCP_NEEDS_INCLUDE_DIRS})
LINK_DIRECTORIES(${AITT_TCP_NEEDS_LIBRARY_DIRS})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})

ADD_LIBRARY(TCP_OBJ OBJECT TCP.cc TCPServer.cc)
ADD_LIBRARY(${AITT_TCP} SHARED main.cc Module.cc $<TARGET_OBJECTS:TCP_OBJ>)
TARGET_LINK_LIBRARIES(${AITT_TCP} ${AITT_TCP_NEEDS_LIBRARIES} aitt Threads::Threads ${CMAKE_DL_LIBS})
TARGET_COMPILE_OPTIONS(${AITT_TCP} PUBLIC ${AITT_TCP_NEEDS_CFLAGS_OTHER})

INSTALL(TARGETS ${AITT_TCP} DESTINATION ${CMAKE_INSTALL_LIBDIR})

IF(BUILD_TESTING)
    ADD_SUBDIRECTORY(samples)
    ADD_SUBDIRECTORY(tests)
ENDIF(BUILD_TESTING)
